<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ZHSS Access Pass</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0e17;--card:#111827;--card-border:#1e293b;--text:#f1f5f9;--text-muted:#94a3b8;--accent-pending:#f59e0b;--accent-active:#10b981;--accent-expired:#ef4444;--glow-pending:rgba(245,158,11,0.15);--glow-active:rgba(16,185,129,0.15);--glow-expired:rgba(239,68,68,0.08)}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:0;margin:0;overflow-x:hidden}

/* ===== FULLSCREEN FAR-VIEW (active only) ===== */
.farview{
  display:none;position:fixed;inset:0;z-index:100;
  background:linear-gradient(160deg,#010d07 0%,#021a0e 40%,#010d07 100%);
  flex-direction:column;align-items:center;justify-content:center;
  padding:32px 24px;overflow:hidden;cursor:pointer;
}
.farview.show{display:flex}

.farview::before{
  content:'';position:absolute;inset:0;
  border:4px solid rgba(16,185,129,0.6);
  box-shadow:inset 0 0 100px rgba(16,185,129,0.08),0 0 60px rgba(16,185,129,0.06);
  animation:border-pulse 2.5s ease-in-out infinite;pointer-events:none;
}
@keyframes border-pulse{0%,100%{border-color:rgba(16,185,129,0.7);box-shadow:inset 0 0 100px rgba(16,185,129,0.08)}50%{border-color:rgba(16,185,129,0.3);box-shadow:inset 0 0 40px rgba(16,185,129,0.03)}}

/* Falling particle lines */
.farview-particles{position:absolute;inset:0;overflow:hidden;opacity:0.05;pointer-events:none}
.fv-particle{position:absolute;width:1px;background:linear-gradient(to bottom,transparent,var(--accent-active),transparent);animation:pfall linear infinite}
@keyframes pfall{0%{transform:translateY(-100vh)}100%{transform:translateY(100vh)}}

/* Pulsing ring */
.fv-ring{width:180px;height:180px;border-radius:50%;position:relative;margin-bottom:28px;display:flex;align-items:center;justify-content:center}
.fv-ring-o1{position:absolute;inset:-24px;border-radius:50%;border:1px solid rgba(16,185,129,0.1);animation:ring-b 3s ease-in-out infinite 0.6s}
.fv-ring-o2{position:absolute;inset:-12px;border-radius:50%;border:1.5px solid rgba(16,185,129,0.2);animation:ring-b 3s ease-in-out infinite 0.3s}
.fv-ring-o3{position:absolute;inset:0;border-radius:50%;border:2px solid rgba(16,185,129,0.4);animation:ring-b 3s ease-in-out infinite}
@keyframes ring-b{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.06);opacity:0.4}}
.fv-ring-inner{
  width:148px;height:148px;border-radius:50%;
  background:radial-gradient(circle,rgba(16,185,129,0.12) 0%,rgba(16,185,129,0.03) 70%,transparent 100%);
  border:2px solid rgba(16,185,129,0.35);
  display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;z-index:1;
}
.fv-check{font-size:56px;line-height:1;margin-bottom:2px}
.fv-label{font-family:'DM Mono',monospace;font-size:12px;font-weight:700;letter-spacing:0.14em;text-transform:uppercase;color:var(--accent-active)}

.fv-class{font-size:52px;font-weight:800;color:#fff;text-align:center;line-height:1.1;margin-bottom:6px;text-shadow:0 0 30px rgba(16,185,129,0.25)}
.fv-subject{font-family:'DM Mono',monospace;font-size:15px;color:var(--accent-active);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:20px}
.fv-clock{font-family:'DM Mono',monospace;font-size:44px;font-weight:500;color:#fff;letter-spacing:0.06em;margin-bottom:6px;animation:clock-glow 2s ease-in-out infinite}
@keyframes clock-glow{0%,100%{text-shadow:0 0 15px rgba(16,185,129,0.25)}50%{text-shadow:0 0 35px rgba(16,185,129,0.45)}}
.fv-expires{font-family:'DM Mono',monospace;font-size:13px;color:var(--text-muted);letter-spacing:0.06em;margin-bottom:20px}

.fv-watermark-wrap{position:absolute;bottom:52px;left:0;right:0;overflow:hidden;opacity:0.035;pointer-events:none}
.fv-watermark-text{white-space:nowrap;font-family:'DM Mono',monospace;font-size:10px;letter-spacing:0.3em;text-transform:uppercase;color:#fff;animation:wmscroll 25s linear infinite}
@keyframes wmscroll{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}

.fv-tap{font-family:'DM Mono',monospace;font-size:10px;color:rgba(148,163,184,0.3);letter-spacing:0.1em;text-transform:uppercase;margin-top:4px}
.fv-footer{position:absolute;bottom:16px;left:0;right:0;text-align:center;font-family:'DM Mono',monospace;font-size:10px;color:rgba(148,163,184,0.4);letter-spacing:0.06em}
.fv-footer-dot{display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--accent-active);margin-right:6px;vertical-align:middle;animation:blink 1.5s ease-in-out infinite}

/* ===== NORMAL PASS VIEW ===== */
.pass-wrap{display:none;width:100%;padding:20px}
.pass-wrap.show{display:flex;align-items:center;justify-content:center}
.pass-container{width:100%;max-width:520px;position:relative;z-index:1}
.error-container{width:100%;max-width:420px;text-align:center;position:relative;z-index:1;padding:20px}
.error-icon{font-size:48px;margin-bottom:12px}
.error-title{font-size:20px;font-weight:800;margin-bottom:8px}
.error-text{font-size:14px;color:var(--text-muted);line-height:1.6}
.status-beacon{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:24px;font-family:'DM Mono',monospace;font-size:13px;letter-spacing:0.08em;text-transform:uppercase;color:var(--text-muted)}
.beacon-dot{width:8px;height:8px;border-radius:50%;background:var(--text-muted);position:relative}
.beacon-dot::after{content:'';position:absolute;inset:-4px;border-radius:50%;border:1.5px solid currentColor;opacity:0}
[data-status="pending"] .beacon-dot{background:var(--accent-pending);color:var(--accent-pending)}
[data-status="active"] .beacon-dot{background:var(--accent-active);color:var(--accent-active);animation:pulse-dot 2s ease-in-out infinite}
[data-status="expired"] .beacon-dot{background:var(--accent-expired);color:var(--accent-expired);opacity:0.6}
[data-status="active"] .beacon-dot::after{animation:pulse-ring 2s ease-in-out infinite}
@keyframes pulse-dot{0%,100%{transform:scale(1)}50%{transform:scale(1.3)}}
@keyframes pulse-ring{0%{opacity:0.6;transform:scale(1)}100%{opacity:0;transform:scale(2.5)}}
.pass-card{background:var(--card);border:1px solid var(--card-border);border-radius:20px;overflow:hidden;position:relative;transition:border-color 0.5s,box-shadow 0.5s}
[data-status="active"] .pass-card{border-color:rgba(16,185,129,0.3);box-shadow:0 0 60px var(--glow-active),0 0 120px var(--glow-active)}
[data-status="pending"] .pass-card{border-color:rgba(245,158,11,0.2);box-shadow:0 0 40px var(--glow-pending)}
[data-status="expired"] .pass-card{border-color:rgba(239,68,68,0.15);box-shadow:0 0 20px var(--glow-expired);opacity:0.7}
.pass-header{padding:28px 32px 24px;position:relative;display:flex;justify-content:space-between;align-items:flex-start}
.pass-header::after{content:'';position:absolute;bottom:0;left:32px;right:32px;height:1px;background:linear-gradient(90deg,transparent,var(--card-border),transparent)}
.header-left{flex:1}
.school-tag{font-family:'DM Mono',monospace;font-size:11px;letter-spacing:0.12em;text-transform:uppercase;color:var(--text-muted);margin-bottom:8px}
.pass-title{font-size:22px;font-weight:800;letter-spacing:-0.02em;line-height:1.2}
.pass-subtitle{font-size:14px;color:var(--text-muted);margin-top:6px;font-weight:500}
.phone-icon{font-size:28px;margin-bottom:4px}
.holo-seal{width:72px;height:72px;border-radius:50%;position:relative;flex-shrink:0;margin-left:16px;margin-top:4px}
@property --holo-angle{syntax:'<angle>';initial-value:0deg;inherits:false}
.holo-ring{position:absolute;inset:0;border-radius:50%;border:2.5px solid transparent;background:conic-gradient(from var(--holo-angle,0deg),#10b981,#3b82f6,#8b5cf6,#ec4899,#f59e0b,#10b981) border-box;-webkit-mask:linear-gradient(#fff 0 0) padding-box,linear-gradient(#fff 0 0);-webkit-mask-composite:xor;mask-composite:exclude;animation:holo-spin 3s linear infinite}
@keyframes holo-spin{to{--holo-angle:360deg}}
.holo-inner{position:absolute;inset:6px;border-radius:50%;background:linear-gradient(135deg,#111827,#1e293b);display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden}
.holo-inner::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(16,185,129,0.08),transparent 50%,rgba(59,130,246,0.08));animation:holo-shimmer 2s ease-in-out infinite alternate}
@keyframes holo-shimmer{0%{opacity:0.3}100%{opacity:1}}
.holo-check{font-size:22px;position:relative;z-index:1;line-height:1}
.holo-label{font-family:'DM Mono',monospace;font-size:7px;letter-spacing:0.15em;text-transform:uppercase;color:var(--text-muted);position:relative;z-index:1;margin-top:1px}
[data-status="expired"] .holo-seal,[data-status="pending"] .holo-seal{opacity:0.3}
[data-status="expired"] .holo-ring,[data-status="pending"] .holo-ring{animation:none}
.motion-watermark{position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;overflow:hidden;z-index:1;opacity:0.025}
.motion-watermark-text{position:absolute;white-space:nowrap;font-family:'DM Mono',monospace;font-size:11px;font-weight:500;letter-spacing:0.3em;text-transform:uppercase;color:#fff;animation:wmscroll 20s linear infinite}
.motion-watermark-text:nth-child(1){top:15%;animation-duration:22s}
.motion-watermark-text:nth-child(2){top:35%;animation-duration:18s;animation-delay:-6s}
.motion-watermark-text:nth-child(3){top:55%;animation-duration:25s;animation-delay:-12s}
.motion-watermark-text:nth-child(4){top:75%;animation-duration:20s;animation-delay:-3s}
.motion-watermark-text:nth-child(5){top:92%;animation-duration:23s;animation-delay:-9s}
.pass-id-strip{padding:10px 32px;display:flex;align-items:center;justify-content:space-between;position:relative}
.pass-id-strip::after{content:'';position:absolute;bottom:0;left:32px;right:32px;height:1px;background:linear-gradient(90deg,transparent,var(--card-border),transparent)}
.pass-id-text{font-family:'DM Mono',monospace;font-size:10px;color:var(--text-muted);letter-spacing:0.06em}
.status-banner{padding:20px 32px;display:flex;align-items:center;justify-content:space-between;gap:16px;position:relative}
.status-banner::after{content:'';position:absolute;bottom:0;left:32px;right:32px;height:1px;background:linear-gradient(90deg,transparent,var(--card-border),transparent)}
.status-label{font-size:13px;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;padding:6px 16px;border-radius:100px;transition:all 0.5s}
[data-status="pending"] .status-label{background:rgba(245,158,11,0.12);color:var(--accent-pending)}
[data-status="active"] .status-label{background:rgba(16,185,129,0.12);color:var(--accent-active)}
[data-status="expired"] .status-label{background:rgba(239,68,68,0.1);color:var(--accent-expired)}
.countdown{font-family:'DM Mono',monospace;font-size:15px;color:var(--text-muted);text-align:right;line-height:1.5}
.countdown-value{color:var(--text);font-weight:500}
.progress-track{height:3px;background:rgba(255,255,255,0.04);overflow:hidden}
.progress-fill{height:100%;width:0%;transition:width 1s linear,background 0.5s;border-radius:0 2px 2px 0}
[data-status="pending"] .progress-fill{background:var(--accent-pending);width:0%}
[data-status="active"] .progress-fill{background:var(--accent-active)}
[data-status="expired"] .progress-fill{background:var(--accent-expired);width:100%;opacity:0.4}
.pass-body{padding:28px 32px;position:relative;z-index:2}
.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px 24px}
.detail-item.full-width{grid-column:1/-1}
.detail-label{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:0.14em;text-transform:uppercase;color:var(--text-muted);margin-bottom:5px}
.detail-value{font-size:15px;font-weight:600;line-height:1.4}
.back-btn-wrap{padding:20px 32px;border-top:1px solid var(--card-border);background:rgba(0,0,0,0.2);text-align:center;position:relative;z-index:2}
.back-btn{padding:10px 24px;border:1.5px solid rgba(16,185,129,0.3);border-radius:10px;cursor:pointer;font-family:'DM Mono',monospace;font-size:12px;background:rgba(16,185,129,0.06);color:var(--accent-active);transition:all 0.3s;letter-spacing:0.04em}
.back-btn:hover{background:rgba(16,185,129,0.12);border-color:rgba(16,185,129,0.5)}
.teacher-verify{padding:20px 32px;position:relative;z-index:2;border-top:1px solid var(--card-border);background:rgba(0,0,0,0.2)}
.teacher-verify-header{display:flex;align-items:center;gap:8px;margin-bottom:14px;font-family:'DM Mono',monospace;font-size:11px;letter-spacing:0.1em;text-transform:uppercase;color:var(--text-muted)}
.teacher-verify-header span:first-child{font-size:15px}
.token-input-row{display:flex;gap:10px;align-items:center}
.token-input{flex:1;padding:10px 14px;font-family:'DM Mono',monospace;font-size:15px;letter-spacing:0.1em;background:rgba(0,0,0,0.3);border:1.5px solid var(--card-border);border-radius:10px;color:var(--text);outline:none;transition:border-color 0.3s,box-shadow 0.3s}
.token-input::placeholder{color:#475569;letter-spacing:0.05em;font-size:13px}
.token-input:focus{border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,0.15)}
.token-btn{padding:10px 20px;border:none;border-radius:10px;cursor:pointer;font-family:'DM Mono',monospace;font-size:13px;font-weight:500;letter-spacing:0.06em;text-transform:uppercase;background:#1e293b;color:var(--text-muted);transition:all 0.3s;white-space:nowrap}
.token-btn:hover{background:#334155;color:var(--text)}
.token-result{margin-top:12px;padding:10px 14px;border-radius:10px;font-family:'DM Mono',monospace;font-size:12px;letter-spacing:0.04em;display:none;align-items:center;gap:8px;line-height:1.5;animation:ri 0.3s ease-out}
@keyframes ri{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}
.token-result.success{display:flex;background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.25);color:var(--accent-active)}
.token-result.fail{display:flex;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.2);color:var(--accent-expired)}
.token-result-icon{font-size:16px;flex-shrink:0}
.teacher-verified-badge{display:none;margin-top:12px;padding:12px 16px;border-radius:12px;background:linear-gradient(135deg,rgba(16,185,129,0.08),rgba(59,130,246,0.06));border:1px solid rgba(16,185,129,0.2);text-align:center;animation:bi 0.5s ease-out}
.teacher-verified-badge.show{display:block}
@keyframes bi{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}
.badge-checkmark{font-size:28px;display:block;margin-bottom:4px}
.badge-text{font-family:'DM Mono',monospace;font-size:11px;letter-spacing:0.1em;text-transform:uppercase;color:var(--accent-active);font-weight:500}
.badge-timestamp{font-family:'DM Mono',monospace;font-size:10px;color:var(--text-muted);margin-top:4px}
.pass-footer{padding:18px 32px;border-top:1px solid var(--card-border);display:flex;align-items:center;justify-content:space-between;background:rgba(0,0,0,0.15);position:relative;z-index:2}
.live-clock{font-family:'DM Mono',monospace;font-size:13px;color:var(--text-muted);display:flex;align-items:center;gap:8px}
.live-indicator{width:6px;height:6px;border-radius:50%;background:var(--accent-active);animation:blink 1.5s ease-in-out infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}
.clock-time{font-size:20px;font-weight:500;color:var(--text);font-family:'DM Mono',monospace;letter-spacing:0.04em}
.contact-bar{margin-top:16px;text-align:center;font-size:12px;color:var(--text-muted);font-family:'DM Mono',monospace;letter-spacing:0.04em}
.anti-screenshot{margin-top:12px;text-align:center;font-size:10px;color:#475569;font-family:'DM Mono',monospace;letter-spacing:0.06em;line-height:1.6}
.pending-overlay,.expired-overlay{display:none;position:absolute;inset:0;background:rgba(10,14,23,0.75);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);z-index:10;align-items:center;justify-content:center;border-radius:20px;flex-direction:column;gap:12px}
[data-status="pending"] .pending-overlay{display:flex}
[data-status="expired"] .expired-overlay{display:flex}
.pending-icon,.expired-icon{font-size:48px}
.expired-icon{opacity:0.6}
.pending-stamp{font-size:26px;font-weight:800;color:var(--accent-pending);letter-spacing:0.06em;text-transform:uppercase;border:3px solid var(--accent-pending);padding:8px 32px;border-radius:8px;opacity:0.85}
.expired-stamp{font-size:42px;font-weight:800;color:var(--accent-expired);transform:rotate(-12deg);letter-spacing:0.06em;text-transform:uppercase;opacity:0.7;border:4px solid var(--accent-expired);padding:8px 32px;border-radius:8px}
.pending-subtext,.expired-subtext{font-family:'DM Mono',monospace;font-size:12px;color:var(--text-muted);letter-spacing:0.06em;text-align:center;line-height:1.6;max-width:300px}
.pending-countdown-display{font-family:'DM Mono',monospace;font-size:22px;font-weight:500;color:var(--text);letter-spacing:0.08em;margin-top:4px}
@keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-6px)}40%,80%{transform:translateX(6px)}}
@media(max-width:480px){
  .pass-header,.status-banner,.pass-body,.pass-footer,.pass-id-strip,.teacher-verify,.back-btn-wrap{padding-left:20px;padding-right:20px}
  .pass-header::after,.status-banner::after,.pass-id-strip::after{left:20px;right:20px}
  .detail-grid{grid-template-columns:1fr;gap:16px}.pass-title{font-size:19px}
  .expired-stamp{font-size:32px;padding:6px 24px}.pending-stamp{font-size:20px;padding:6px 24px}
  .holo-seal{width:58px;height:58px}.holo-check{font-size:18px}
  .token-input-row{flex-direction:column}.token-btn{width:100%;text-align:center}
  .fv-class{font-size:42px}.fv-clock{font-size:36px}
  .fv-ring{width:150px;height:150px}.fv-ring-inner{width:120px;height:120px}.fv-check{font-size:44px}
}
</style>
</head>
<body>

<!-- ===== FULLSCREEN FAR-VIEW ===== -->
<div class="farview" id="farView" onclick="showDetails()">
  <div class="farview-particles" id="particles"></div>
  <div class="fv-ring">
    <div class="fv-ring-o1"></div>
    <div class="fv-ring-o2"></div>
    <div class="fv-ring-o3"></div>
    <div class="fv-ring-inner">
      <div class="fv-check">‚úì</div>
      <div class="fv-label">Authorised</div>
    </div>
  </div>
  <div class="fv-class" id="fvClass"></div>
  <div class="fv-subject" id="fvSubject"></div>
  <div class="fv-clock" id="fvClock">--:--:--</div>
  <div class="fv-expires" id="fvExpires"></div>
  <div class="fv-watermark-wrap"><div class="fv-watermark-text" id="fvWatermark"></div></div>
  <div class="fv-tap">Tap for details</div>
  <div class="fv-footer"><span class="fv-footer-dot"></span>ZHSS Verified Pass ‚Äî SGT Live</div>
</div>

<!-- ===== ERROR ===== -->
<div class="error-container" id="errorView" style="display:none;">
  <div class="error-icon">‚ö†Ô∏è</div>
  <div class="error-title">Invalid Pass Link</div>
  <div class="error-text">This link does not contain valid pass data.<br>Please contact the issuing teacher for a valid link.</div>
</div>

<!-- ===== NORMAL PASS VIEW ===== -->
<div class="pass-wrap" id="passWrap">
  <div class="pass-container" id="passView">
    <div class="status-beacon"><span class="beacon-dot"></span><span>Synced to SGT (UTC+8)</span></div>
    <div class="pass-card">
      <div class="motion-watermark" id="watermark"></div>
      <div class="pending-overlay">
        <div class="pending-icon">üîí</div>
        <div class="pending-stamp">Not Yet Active</div>
        <div class="pending-subtext" id="pendingInfo"></div>
        <div class="pending-countdown-display" id="pendingCountdown">--:--:--</div>
        <div class="pending-subtext">Phone use is not permitted until the pass is active.</div>
      </div>
      <div class="expired-overlay">
        <div class="expired-icon">‚õî</div>
        <div class="expired-stamp">Expired</div>
        <div class="expired-subtext" id="expiredInfo"></div>
      </div>
      <div class="pass-header">
        <div class="header-left">
          <div class="school-tag">Zhenghua Secondary School</div>
          <div class="phone-icon">üì±</div>
          <div class="pass-title">Mobile Phone Access Pass</div>
          <div class="pass-subtitle" id="pSubtitle"></div>
        </div>
        <div class="holo-seal"><div class="holo-ring"></div><div class="holo-inner"><span class="holo-check">‚úì</span><span class="holo-label">Verified</span></div></div>
      </div>
      <div class="pass-id-strip">
        <div class="pass-id-text" id="pPassId"></div>
        <div class="pass-id-text" id="pIssued"></div>
      </div>
      <div class="status-banner">
        <span class="status-label" id="statusLabel">PENDING</span>
        <div class="countdown" id="countdown"></div>
      </div>
      <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>
      <div class="pass-body">
        <div class="detail-grid">
          <div class="detail-item"><div class="detail-label">Class</div><div class="detail-value" id="pClass"></div></div>
          <div class="detail-item"><div class="detail-label">Subject</div><div class="detail-value" id="pSubject"></div></div>
          <div class="detail-item"><div class="detail-label">Date</div><div class="detail-value" id="pDate"></div></div>
          <div class="detail-item"><div class="detail-label">Valid Window</div><div class="detail-value" id="pWindow"></div></div>
          <div class="detail-item full-width"><div class="detail-label">Purpose</div><div class="detail-value" id="pPurpose"></div></div>
          <div class="detail-item full-width"><div class="detail-label">Scope</div><div class="detail-value" id="pScope"></div></div>
          <div class="detail-item full-width"><div class="detail-label">Authorised By</div><div class="detail-value" id="pTeacher"></div></div>
        </div>
      </div>
      <div class="back-btn-wrap" id="backBtnWrap" style="display:none">
        <button class="back-btn" onclick="showFarView()">‚Üë Back to verification display</button>
      </div>
      <div class="teacher-verify">
        <div class="teacher-verify-header"><span>üîê</span><span>Teacher Verification</span></div>
        <div class="token-input-row">
          <input type="password" class="token-input" id="tokenInput" placeholder="Enter teacher token key" autocomplete="off" spellcheck="false">
          <button class="token-btn" id="tokenBtn" onclick="verifyToken()">Verify</button>
        </div>
        <div class="token-result" id="tokenResult"></div>
        <div class="teacher-verified-badge" id="verifiedBadge">
          <span class="badge-checkmark">‚úÖ</span>
          <div class="badge-text">Authenticity Confirmed</div>
          <div class="badge-timestamp" id="badgeTimestamp"></div>
        </div>
      </div>
      <div class="pass-footer">
        <div class="live-clock"><span class="live-indicator"></span><span>SGT Live</span></div>
        <div class="clock-time" id="liveClock">--:--:--</div>
      </div>
    </div>
    <div class="contact-bar" id="pContact"></div>
    <div class="anti-screenshot">‚ö† This pass contains live-animated verification elements.<br>Screenshots or duplicates will lack animation and are considered invalid.</div>
  </div>
</div>

<script>
var VERIFY_TOKEN='Zss2026';
var PASS_START,PASS_END,PASS_DURATION;
var currentStatus='pending';

function pad(n){return String(n).padStart(2,'0')}
function getSGT(){return new Date(Date.now()+(new Date().getTimezoneOffset()*60000)+(8*3600000))}

// Generate particles for far-view
var particlesEl=document.getElementById('particles');
for(var i=0;i<20;i++){
  var p=document.createElement('div');
  p.className='fv-particle';
  p.style.left=Math.random()*100+'%';
  p.style.height=(40+Math.random()*80)+'px';
  p.style.animationDuration=(4+Math.random()*8)+'s';
  p.style.animationDelay=(-Math.random()*10)+'s';
  particlesEl.appendChild(p);
}

// Parse data
var data=null;
try{var hash=window.location.hash.slice(1);if(hash)data=JSON.parse(atob(hash))}catch(e){data=null}

if(!data){
  document.getElementById('errorView').style.display='block';
  document.getElementById('farView').style.display='none';
  document.getElementById('passWrap').style.display='none';
}else{
  initPass(data);
}

function showDetails(){
  document.getElementById('farView').classList.remove('show');
  document.getElementById('passWrap').classList.add('show');
  if(currentStatus==='active')document.getElementById('backBtnWrap').style.display='block';
}

function showFarView(){
  if(currentStatus==='active'){
    document.getElementById('farView').classList.add('show');
    document.getElementById('passWrap').classList.remove('show');
  }
}

function initPass(d){
  PASS_START=new Date(d.date+'T'+d.start+':00+08:00').getTime();
  PASS_END=new Date(d.date+'T'+d.end+':00+08:00').getTime();
  PASS_DURATION=PASS_END-PASS_START;

  var days=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  var months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  var dateObj=new Date(d.date+'T00:00:00');
  var dateDisplay=dateObj.getDate()+' '+months[dateObj.getMonth()]+' '+dateObj.getFullYear()+' ('+days[dateObj.getDay()]+')';
  var startDisplay=d.start.replace(':','');
  var endDisplay=d.end.replace(':','');

  // Detail view
  document.getElementById('pClass').textContent=d.cls;
  document.getElementById('pSubject').textContent=d.subject;
  document.getElementById('pPurpose').textContent=d.purpose;
  document.getElementById('pScope').textContent=d.scope;
  document.getElementById('pTeacher').textContent=d.teacher;
  document.getElementById('pPassId').textContent=d.passId;
  document.getElementById('pIssued').textContent='Issued: '+d.issued;
  document.getElementById('pDate').textContent=dateDisplay;
  document.getElementById('pWindow').textContent=startDisplay+' \u2013 '+endDisplay+' hrs';
  document.getElementById('pSubtitle').textContent='Temporary authorisation \u2014 '+d.scope.toLowerCase();
  document.getElementById('pContact').textContent='For queries, contact '+d.teacher;
  document.getElementById('pendingInfo').innerHTML='This pass activates on<br><strong>'+dateDisplay+' at '+startDisplay+' hrs</strong>';
  document.getElementById('expiredInfo').innerHTML='This pass expired at '+endDisplay+' hrs.<br>Phone use is no longer permitted.';
  document.title='ZHSS Pass \u2014 '+d.cls+' '+d.subject;

  // Far-view
  document.getElementById('fvClass').textContent=d.cls;
  document.getElementById('fvSubject').textContent=d.subject;
  var wmText='ZHENGHUA SECONDARY \u2014 OFFICIAL PASS \u2014 '+d.cls+' '+d.subject+' \u2014 AUTHORISED BY '+d.teacher.toUpperCase()+' \u2014 ';
  document.getElementById('fvWatermark').textContent=wmText+wmText+wmText;

  // Watermark for detail view
  var wm=document.getElementById('watermark');
  var wmDetail=wmText+wmText;
  for(var i=0;i<5;i++){var div=document.createElement('div');div.className='motion-watermark-text';div.textContent=wmDetail;wm.appendChild(div)}

  update();
  setInterval(update,1000);
}

function fmtDur(ms){if(ms<=0)return'0s';var t=Math.floor(ms/1000),h=Math.floor(t/3600),m=Math.floor((t%3600)/60),s=t%60;if(h>0)return h+'h '+pad(m)+'m '+pad(s)+'s';if(m>0)return m+'m '+pad(s)+'s';return s+'s'}
function fmtLg(ms){if(ms<=0)return'00:00:00';var t=Math.floor(ms/1000);return pad(Math.floor(t/3600))+':'+pad(Math.floor((t%3600)/60))+':'+pad(t%60)}

function update(){
  var now=Date.now(),sgt=getSGT();
  var timeStr=pad(sgt.getHours())+':'+pad(sgt.getMinutes())+':'+pad(sgt.getSeconds());

  // Update all clocks
  document.getElementById('liveClock').textContent=timeStr;
  document.getElementById('fvClock').textContent=timeStr;

  var prevStatus=currentStatus;

  if(now<PASS_START){
    currentStatus='pending';
    document.getElementById('passView').setAttribute('data-status','pending');
    document.getElementById('statusLabel').textContent='PENDING';
    document.getElementById('countdown').innerHTML='Starts in<br><span class="countdown-value">'+fmtDur(PASS_START-now)+'</span>';
    document.getElementById('progressFill').style.width='0%';
    document.getElementById('pendingCountdown').textContent=fmtLg(PASS_START-now);

    // Show detail view for pending (blurred overlay)
    document.getElementById('farView').classList.remove('show');
    document.getElementById('passWrap').classList.add('show');
    document.getElementById('backBtnWrap').style.display='none';

  }else if(now>=PASS_START&&now<PASS_END){
    currentStatus='active';
    document.getElementById('passView').setAttribute('data-status','active');
    document.getElementById('statusLabel').textContent='ACTIVE';
    var pct=Math.min(((now-PASS_START)/PASS_DURATION)*100,100);
    document.getElementById('countdown').innerHTML='Expires in<br><span class="countdown-value">'+fmtDur(PASS_END-now)+'</span>';
    document.getElementById('progressFill').style.width=pct+'%';
    document.getElementById('fvExpires').textContent='Expires in '+fmtDur(PASS_END-now);
    document.getElementById('backBtnWrap').style.display='block';

    // Auto-switch to far-view when it first becomes active
    if(prevStatus==='pending'){
      document.getElementById('farView').classList.add('show');
      document.getElementById('passWrap').classList.remove('show');
    }

  }else{
    currentStatus='expired';
    document.getElementById('passView').setAttribute('data-status','expired');
    document.getElementById('statusLabel').textContent='EXPIRED';
    document.getElementById('countdown').innerHTML='Ended';
    document.getElementById('progressFill').style.width='100%';

    // Show detail view for expired (expired overlay)
    document.getElementById('farView').classList.remove('show');
    document.getElementById('passWrap').classList.add('show');
    document.getElementById('backBtnWrap').style.display='none';
  }
}

function verifyToken(){
  var inp=document.getElementById('tokenInput'),res=document.getElementById('tokenResult'),badge=document.getElementById('verifiedBadge'),v=inp.value.trim();
  if(!v){res.className='token-result fail';res.innerHTML='<span class="token-result-icon">‚ö†Ô∏è</span> Please enter a token key.';badge.classList.remove('show');return}
  if(v===VERIFY_TOKEN){
    var s=getSGT(),ts=pad(s.getHours())+':'+pad(s.getMinutes())+':'+pad(s.getSeconds())+' SGT';
    var months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    var ds=s.getDate()+' '+months[s.getMonth()]+' '+s.getFullYear();
    res.className='token-result success';
    res.innerHTML='<span class="token-result-icon">‚úÖ</span> Token verified \u2014 this is an authentic, officially issued pass.';
    badge.classList.add('show');
    document.getElementById('badgeTimestamp').textContent='Verified at '+ts+' on '+ds;
    inp.disabled=true;inp.style.borderColor='rgba(16,185,129,0.3)';document.getElementById('tokenBtn').style.display='none';
  }else{
    res.className='token-result fail';
    res.innerHTML='<span class="token-result-icon">‚ùå</span> Invalid token. This pass may be forged \u2014 contact the issuing teacher.';
    badge.classList.remove('show');inp.style.animation='none';inp.offsetHeight;inp.style.animation='shake 0.4s ease';
  }
}
document.getElementById('tokenInput').addEventListener('keydown',function(e){if(e.key==='Enter')verifyToken()});
</script>
</body>
</html>
